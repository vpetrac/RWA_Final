@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<div class="jumbotron">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Ime</th>
                <th>Prezime</th>
                <th>Email</th>
                <th>Telefon</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
    </table>
</div>

@section scripts {
    <script>

        const dataTableConfig = {
            ajax: {
                url: '/api/kupci',
                dataSrc: ''
            },
            columns: [
                { data: 'IDKupac' },
                { data: 'Ime' },
                { data: 'Prezime' },
                {
                    data: 'Email',
                    render: function (email) {
                        return `<a href="mailto:${email}">${email}</a>`
                    }
                },
                {
                    data: 'Telefon',
                    render: function (telefon) {
                        return `<a href="tel:${telefon}">${telefon}</a>`
                    }
                },
                {
                    data: '',
                    render: function (data, type, kupac) {
                        return `<button
                                        class="btn btn-warning btn-sm"
                                        data-id=${kupac.IDKupac}
                                        data-ime=${kupac.Ime}
                                        data-prezime=${kupac.Prezime}
                                    >
                                        Ažuriraj
                                    </button>`
                    }
                },
                {
                    data: '',
                    render: function (data, type, kupac) {
                        var link = '@Html.ActionLink("Računi", "PremaKupcu", "Racun", new { id = -1 }, new { @class = "btn btn-primary btn-sm"})';
                        return link.replace('-1', kupac.IDKupac);
                        
                    }
                }
            ]
        }

        const table = $('.table')
            .DataTable(dataTableConfig);

        /*
        let btnDelete;

        const table = $('.table')
            .DataTable(dataTableConfig)
            .on('click', '.btn', onDeleteClick);

        function onDeleteClick(e) {
            btnDelete = this;
            const { id, ime, prezime } = btnDelete.dataset;

            if (confirm(`Obrisati ${ime} ${prezime}`))
                deleteKupac(id);
        }


        function deleteKupac(id) {
            $.ajax({
                url: `api/kupci/${id}`,
                method: 'delete'
            })
                .done(function (message) {
                    console.log(message)
                    table
                        .row($(btnDelete).parents('tr'))
                        .remove()
                        .draw();
                })
                .fail(function () {
                    console.log( `Kupac sa id ${id} nije obrisan` );
                });
        }*/
    </script>
}